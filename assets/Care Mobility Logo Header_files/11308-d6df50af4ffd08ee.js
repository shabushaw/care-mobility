try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a0dbb510-6b22-4c75-beaf-4d5fda4c2554",e._sentryDebugIdIdentifier="sentry-dbid-a0dbb510-6b22-4c75-beaf-4d5fda4c2554")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11308],{0x26cff63b:(e,t,a)=>{a.d(t,{y:()=>u});var n=a(0x628a9a0b),s=a(0x14de19ae8),i=a(0x1de4b2c21);function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e.length<=t)return e;let a=Math.ceil(t/2);return"".concat(e.substring(0,a),"\n\n  [...]\n\n  ").concat(e.substring(e.length-a))}var l=a(0xfc89b4a4);function u(e,t,a){let u=!(arguments.length>3)||void 0===arguments[3]||arguments[3],[o,d]=(0,l.useState)(!1),{activeOrganization:c}=(0,s.YL)(),m=!!e,f=null==e?void 0:e.name,g=(null==t?void 0:t.length)||0,x=(0,l.useMemo)(()=>{let e=null==t?void 0:t[0];return e?(0,i.C)(e):""},[t]),v=(0,l.useMemo)(()=>{if(x)return x;let e=(null==t?void 0:t[1])?(0,i.C)(t[1]):"";return e&&!a?["Message 1:",r(x),"Message 2:",r(e)].join("\n\n"):""},[t,a,x]),p=(null==e?void 0:e.uuid)||"",{mutate:_}=(0,n.HI)(p),{mutate:h,error:b}=(0,n.OZ)(p),y=(0,l.useRef)(!1);(0,l.useEffect)(()=>{if(m&&b&&!f&&x){if(y.current)return;let e=x.slice(0,30),t=x.length>30?"...":"";y.current=!0,_({name:"".concat(e).concat(t)})}},[m,b,f,v,_,x]),(0,l.useEffect)(()=>{m&&c&&u&&!o&&!f&&0!==g&&v&&(d(!0),h({message_content:v,recent_titles:[]}))},[m,c,u,f,h,o,g,v])}},0x3b58c804:(e,t,a)=>{a.d(t,{F:()=>o});var n=a(0xf32c56dd),s=a(0x14de19ae8),i=a(0xac309a83),r=a(0xfc89b4a4),l=a(0x23e1b1f63);let u="payment-verification-reminder-dismissed";function o(){let{activeOrganization:e}=(0,s.YL)(),t=(0,n.st)(),[a,o]=(0,r.useState)(!1),d=(0,i.fS)("show_3ds_modal"),{data:c}=(0,l.PI)(d);return(0,r.useEffect)(()=>{var a;let n=localStorage.getItem(u);if(n){let e=new Date(n).getTime();if(new Date().getTime()-e<864e5)return void o(!1)}let s=d&&null!=(a=null==c?void 0:c.requires_3ds_verification)&&a;o(s),s&&t.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,modal_type:"3ds_verification_required"})},[d,c,t,e]),{shouldShowModal:a,dismissReminder:(0,r.useCallback)(()=>{let a=new Date().toISOString();localStorage.setItem(u,a),o(!1),t.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,action:"3ds_verification_dismissed",dismissed_at:a})},[t,e])}}},0x49ca9b63:(e,t,a)=>{a.r(t),a.d(t,{default:()=>l});var n=a(0x22102fd88),s=a(0x225bae024),i=a(0x14769f769),r=a(0x38e6572);function l(){return(0,n.jsx)(i.R,{productSurface:"claude-ai",headline:(0,n.jsx)(r.A,{defaultMessage:"Page not found",id:"QRccCMoxuD"}),subheading:(0,n.jsx)(r.A,{defaultMessage:"Claude can help with many things, but finding this page isnâ€™t one of them.",id:"k7xSM0388d"}),button:(0,n.jsx)(s.$,{href:"/new",children:(0,n.jsx)(r.A,{defaultMessage:"Go back home",id:"DupNoSk4qt"})})})}},0xb0d325ec:(e,t,a)=>{a.d(t,{ChatClientPage:()=>W});var n=a(0x22102fd88),s=a(0x628a9a0b),i=a(0xb844abc8),r=a(0xfc89b4a4),l=a(0x49ca9b63),u=a(0xec9172c1),o=a(0x16801a2b9),d=a(0x26cff63b),c=a(0x226530adf),m=a(0x2349cee20),f=a(0xf32c56dd),g=a(0x371cc700),x=a(0x1de4b2c21),v=a(0xac309a83),p=a(0x4d348f95),_=a(0x18bfd014),h=a(0x225bae024),b=a(0x183548b63),y=a(0x1ab0d1ca1),M=a(0x38e6572),j=a(0x2662014e),k=a(0x1037073d3),S=a(0x246846ae8),w=a(0xb323e954),C=a(0x4c3e727b),N=a(0x84f104f3),E=a(0x16ba367e),I=a(0x1a1f6dda6);function R(e){let{fieldName:t,fieldSchema:a,isRequired:s,initialValue:i,hasSubmitError:l,clearSubmitError:u}=e,o=(0,y.A)(),[d,c]=(0,r.useState)(i),[m,f]=(0,r.useState)(l?A(d,a,s,o):null),g=(0,r.useCallback)(()=>{f(null),null==u||u(t)},[u,t]),x=(0,r.useCallback)(()=>{f(A(d,a,s,o))},[d,a,s,o]),v=a.type,p=a.title||a.description||t.charAt(0).toUpperCase()+t.slice(1),_=a.title&&a.description,h=(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{children:p}),s&&(0,n.jsx)("span",{className:"text-danger-000",children:"*"})]}),b=e=>(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)(C.J,{label:h,className:"font-medium"}),_&&(0,n.jsx)("p",{className:"text-xs text-text-300 mb-1",children:a.description}),e,m&&(0,n.jsx)("p",{className:"text-xs text-danger-000 mt-1",children:m})]});switch(v){case"boolean":return(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("input",{type:"hidden",name:t,value:d?"true":""}),(0,n.jsx)(w.S,{label:h,checked:!!d,onChange:e=>c(e),onFocus:g,onBlur:x,size:16,className:m?"border-danger-000":""}),_&&(0,n.jsx)("p",{className:"text-xs text-text-300 ml-[28px]",children:a.description}),m&&(0,n.jsx)("p",{className:"text-xs text-danger-000 ml-[28px]",children:m})]});case"number":return b((0,n.jsx)(S.ks,{name:t,type:"number",value:String(null!=d?d:""),onValueChange:e=>{if(!e)return void c("");let t=Number(e);isNaN(t)||c(t)},onFocus:g,onBlur:x,error:!!m,size:"lg",min:a.minimum,max:a.maximum,step:"any"}));case"integer":return b((0,n.jsx)(S.ks,{name:t,type:"number",value:String(null!=d?d:""),onValueChange:e=>{if(!e)return void c("");let t=Number(e);!isNaN(t)&&Number.isInteger(t)&&c(t)},onKeyDown:e=>{("."===e.key||"e"===e.key||"E"===e.key)&&e.preventDefault()},onFocus:g,onBlur:x,error:!!m,size:"lg",min:a.minimum,max:a.maximum,step:1}));case"string":{if(a.enum){let e=a.enum,s=a.enumNames;return b((0,n.jsxs)(N.l6,{name:t,value:String(null!=d?d:""),onValueChange:e=>{c(e),null==u||u(t)},onOpenChange:e=>{e?g():e||void 0===d||x()},variant:m?"danger":"outline",size:"lg",children:[(0,n.jsx)(N.eb,{value:"",children:"\xa0"}),e.map((e,t)=>(0,n.jsx)(N.eb,{value:String(e),children:(null==s?void 0:s[t])||String(e)},t))]}))}let e=a.minLength,s=a.maxLength,r=a.format;if(!r)return b((0,n.jsx)(S.fs,{name:t,value:String(null!=d?d:""),onChange:e=>c(e.target.value),onFocus:g,onBlur:x,minRows:String(null!=i?i:"").split("\n").length,className:m?"border-danger-000":"",minLength:e,maxLength:s}));return b((0,n.jsx)("input",{name:t,type:r,value:String(null!=d?d:""),onChange:e=>c(e.target.value),onFocus:g,onBlur:x,className:(0,I.A)((0,E.j)({size:"lg",error:!!m})),minLength:e,maxLength:s}))}default:return null}}function A(e,t,a,n){if(a){if("boolean"===t.type){if(!0!==e)return n.formatMessage({defaultMessage:"This field must be checked.",id:"J5kfUK4Fet"})}else if(null==e||""===e||"string"==typeof e&&!e.trim())return n.formatMessage({defaultMessage:"This field is required.",id:"6B5JtuWEoY"})}if(null==e||""===e)return null;if("string"===t.type){let a=String(e);if("minLength"in t){let e=t.minLength;if(a.length<e)return n.formatMessage({defaultMessage:"Must be at least {min} characters.",id:"6JNvt/A47+"},{min:e})}if("maxLength"in t){let e=t.maxLength;if(a.length>e)return n.formatMessage({defaultMessage:"Must be at most {max} characters.",id:"oVARYXBJid"},{max:e})}if("pattern"in t&&!new RegExp(t.pattern).test(a))return n.formatMessage({defaultMessage:"Invalid format.",id:"vChcf7nVHS"});if("format"in t){let e=t.format;if("email"===e&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a))return n.formatMessage({defaultMessage:"Invalid email address.",id:"cpZU48Uo5t"});if("uri"===e)try{new URL(a)}catch(e){return n.formatMessage({defaultMessage:"Invalid URL.",id:"ZtqJIdqRiK"})}if("date"===e&&isNaN(new Date(a).getTime()))return n.formatMessage({defaultMessage:"Invalid date.",id:"bnRxzOhnEE"});if("date-time"===e&&isNaN(new Date(a).getTime()))return n.formatMessage({defaultMessage:"Invalid date and time.",id:"HTTZjKGN9a"})}}if("number"===t.type||"integer"===t.type){let a=Number(e);if(isNaN(a))return n.formatMessage({defaultMessage:"Must be a valid number.",id:"Z8e10tpxeL"});if("integer"===t.type&&!Number.isInteger(a))return n.formatMessage({defaultMessage:"Must be a whole number.",id:"5kFFmX4YGx"});if("minimum"in t){let e=t.minimum;if(a<e)return n.formatMessage({defaultMessage:"Must be at least {min}.",id:"85q0hz8G+z"},{min:e})}if("maximum"in t){let e=t.maximum;if(a>e)return n.formatMessage({defaultMessage:"Must be at most {max}.",id:"HrCLJ+XSxg"},{max:e})}}return null}function D(){let e=(0,y.A)(),t=(0,j.c)(e=>e.currentRequest),{acceptElicitation:a,declineElicitation:s,cancelElicitation:i}=(0,j.c)(),[l,u]=(0,r.useState)(new Set),o=(0,r.useMemo)(()=>{if(!t)return{};let e={};return Object.entries(t.request.params.requestedSchema.properties).forEach(t=>{let[a,n]=t;"default"in n&&void 0!==n.default&&(e[a]=n.default)}),e},[t]),d=(0,r.useCallback)(n=>{if(n.preventDefault(),!t)return;let s=n.currentTarget,i=new FormData(s),r={},l=new Set,o=t.request.params.requestedSchema;if(Object.entries(o.properties).forEach(t=>{var a,n;let[s,u]=t,d=i.get(s),c=d;"number"===u.type||"integer"===u.type?c=""===d||null===d?void 0:Number(d):"boolean"===u.type&&(c="true"===d),r[s]=c,A(c,u,null!=(n=null==(a=o.required)?void 0:a.includes(s))&&n,e)&&l.add(s)}),l.size>0){u(l);let e=Array.from(l)[0],t=s.querySelector('[name="'.concat(e,'"]'));null==t||t.scrollIntoView({behavior:"smooth",block:"center"});return}a(r),u(new Set)},[t,a,e]),c=(0,r.useCallback)(()=>{s(),u(new Set)},[s]),m=(0,r.useCallback)(()=>{i(),u(new Set)},[i]),f=(0,r.useCallback)(e=>()=>{u(t=>{let a=new Set(t);return a.delete(e),a})},[]);if(!t)return null;let{request:g,serverName:x,iconType:v,iconSrc:p}=t,_=g.params.requestedSchema,S=(0,n.jsx)(k.z,{size:30,imageSize:20,name:x,type:v,src:p});return(0,n.jsx)(b.aF,{title:"".concat(x," requests your input"),icon:S,isOpen:null!==t,onClose:m,modalSize:"lg",children:(0,n.jsxs)("form",{onSubmit:d,children:[(0,n.jsx)("div",{className:"py-4",children:(0,n.jsxs)("div",{className:"flex flex-col gap-4 max-h-[500px] overflow-y-auto p-2",children:[g.params.message&&(0,n.jsx)("p",{className:"text-sm text-text-300",children:g.params.message}),Object.entries(_.properties).map(e=>{var t,a;let[s,i]=e;return(0,n.jsx)(R,{fieldName:s,fieldSchema:i,isRequired:null!=(a=null==(t=_.required)?void 0:t.includes(s))&&a,initialValue:o[s],hasSubmitError:l.has(s),clearSubmitError:f},s)})]})}),(0,n.jsxs)(b.vW,{children:[(0,n.jsx)(h.$,{type:"button",onClick:c,variant:"secondary",children:(0,n.jsx)(M.A,{defaultMessage:"Decline",id:"pvtgR26QWY"})}),(0,n.jsx)(h.$,{type:"submit",variant:"primary",children:(0,n.jsx)(M.A,{defaultMessage:"Submit",id:"wSZR47Y5kj"})})]})]})})}var z=a(0x62983db6),q=a(0x2504fdeeb),L=a(0x922ef01f),T=a(0x17e7bc007),F=a(0x12bfc937),U=a(0x20885504e),O=a(0xeac7cde8),P=a(0x3d2215b3),V=a(0x12c9046cd),B=a(0x14de19ae8),Y=a(0x139b5e710),H=a(0x1016c6ed2),G=a(0xe670e093),J=a(0x17e725145);function K(e){var t,a,i,l;let{conversation:u,conversationUuid:o,chatInputDefaultMessage:h,returnDanglingHumanMessage:b}=e,y=(0,p.useRouter)(),{incognitoModeEnabled:M}=(0,_.S)(),{track:j}=(0,f.st)(),k=(0,L.Xi)(e=>e.isInIframe),{data:S,isLoading:w,isRefetching:C,isPlaceholderData:N}=(0,s.Bq)(o,{suppressError:!0,returnDanglingHumanMessage:b}),E=(0,r.useMemo)(()=>{if((null==S?void 0:S.danglingHumanMessages)&&S.danglingHumanMessages.length>0)return S.danglingHumanMessages[S.danglingHumanMessages.length-1]},[S]),I=null==S?void 0:S.project_uuid,R=(0,T.gq)(),A=(0,T.xw)(o),{changeDisplayedConversationPath:K}=(0,m.G)(),Q=(0,c.Z3)(o),X=(0,P.n)(null!=(a=null==u?void 0:u.settings)?a:null==S?void 0:S.settings,null==u?void 0:u.project_uuid,Q),{markMessageSent:Z,markFirstTokenReceived:W,setStreamStartMetadata:$}=(0,q.B)(),ee=(0,r.useCallback)(e=>{W({model:Q,first_content_type:e})},[W,Q]),et=(0,r.useCallback)(e=>{$({assistantMessageUuid:e.assistantMessageUuid,humanMessageUuid:e.humanMessageUuid})},[$]);(0,r.useEffect)(()=>{if(!M||!(null==S?void 0:S.updated_at))return;let e=()=>{let e=new Date(S.updated_at).getTime();(Date.now()-e)/36e5>=47&&y.push("/new")};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[M,null==S?void 0:S.updated_at,y]);let[ea,en]=(0,r.useState)(),es=(0,r.useCallback)(e=>{en(e)},[en]),[ei,er]=(0,r.useState)(0),el=(0,r.useCallback)(e=>{er(e)},[]),eu=(0,U.N)(),eo=(0,v.fS)("claudeai_inline_conversation_creation"),[ed,ec]=(0,r.useState)(()=>{var e,t;return!eo||(null!=(t=null==S||null==(e=S.chat_messages)?void 0:e.length)?t:0)>0}),em=(0,r.useCallback)(()=>{ec(!0)},[]),ef=(0,F.G)(o,I,X,ee,R,el,eu?E:void 0,em,b,et),eg=(0,F.S)(o,I,X,ea,ee,R,el,eu?E:void 0,b,et),{mutate:ex}=(0,s.lj)(o),ev=eu&&!!E,ep=ef.isStreaming||eg.isStreaming||ev,e_=ef.isReconnected||eg.isReconnected,eh=(0,r.useCallback)(async e=>(er(0),ef.runStream(e)),[ef]),eb=(0,r.useCallback)(async(e,t,a,n)=>{var s,i,r,l,u;er(0);let d=Math.floor((null!=(i=null==S||null==(s=S.chat_messages)?void 0:s.length)?i:0)/2),c=null==S?void 0:S.settings,m=Object.values(null!=(r=null==c?void 0:c.enabled_mcp_tools)?r:{}).filter(Boolean).length;return Z({conversation_uuid:o,message_length:0,message_index:d,is_new_conversation:!1,is_retry:!0,is_incognito:M,is_yukon_gold:null!=(l=null==c?void 0:c.enabled_yukon_gold)&&l,document_attachment_count:0,image_attachment_count:0,thinking_mode:(null==c?void 0:c.paprika_mode)==="extended"?"enabled":"disabled",research_mode:(null==c?void 0:c.compass_mode)==="advanced"?"advanced":"disabled",tool_count:m,enabled_web_search:null!=(u=null==c?void 0:c.enabled_web_search)&&u}),eg.runStream(e,t,a,n)},[eg,o,S,M,Z]);(0,d.y)(S,null==S?void 0:S.chat_messages,ep,ed);let ey=null==(t=(0,T.Q3)(o))?void 0:t.uuid,eM=(0,r.useCallback)(async(e,t)=>{var a,n;let s=(0,x.C)(e);s!==t&&(j({event_key:"claudeai.message.edited",is_last_human_message:e.uuid===ey,is_identical_content:s===t}),await eh({prompt:t,attachments:e.attachments,files:null!=(n=e.files_v2)?n:e.files,syncSources:e.sync_sources,parent_message_uuid:e.parent_message_uuid,personalized_style:ea,compass_mode:null==(a=e.metadata)?void 0:a.compass_mode}))},[eh,ea,j,ey]),ej=(0,r.useCallback)((e,t)=>{j({event_key:"claudeai.conversation_tree.navigated",direction:1===t?"next":"previous",is_last_human_message:e.uuid===ey}),K(o,e,t,e=>ex({current_leaf_message_uuid:e}))},[K,o,ex,j,ey]),{hasPendingUserMessage:ek,isCompletionStatusLoading:eS,stopPendingRecovery:ew}=function(e){let{conversationUuid:t,pendingUserMessage:a,chatConversationTree:n,isLoading:i}=e,l=(0,r.useRef)(!1),u=(0,r.useRef)(null),o=(0,r.useRef)(null),d=(0,r.useRef)(null),m=(0,T.uQ)(),f=(0,T.Gu)(),g=(0,T.RR)(),{activeOrganization:x}=(0,B.YL)(),{addError:v}=(0,Y.Yf)(),{setFailedStreamRetryData:p}=(0,c.x)(),_=(0,J.useQueryClient)(),[h,b]=(0,r.useState)(!1),[y,M]=(0,r.useState)(!1),{data:j,isLoading:k}=(0,V.Sk)((null==x?void 0:x.uuid)&&t&&a?"/api/organizations/".concat(x.uuid,"/chat_conversations/").concat(t,"/completion_status?poll=false"):"",{enabled:!!(null==x?void 0:x.uuid)&&!!t&&!i&&!!a&&!l.current,staleTime:0,refetchOnWindowFocus:!1}),S=(0,r.useCallback)(()=>{var e;a&&p({prompt:(null!=(e=a.content)?e:[]).filter(e=>"text"===e.type).map(e=>e.text).join(""),attachments:a.attachments||[],files:a.files_v2||[]})},[a,p]),w=(0,r.useCallback)(()=>{o.current&&(o.current.abort(),o.current=null),d.current&&(clearTimeout(d.current),d.current=null)},[]),C=(0,r.useCallback)(()=>{let e=g(t),n=e.filter(e=>e.uuid!==(null==a?void 0:a.uuid)&&e.uuid!==u.current);n.length!==e.length&&f(t,n)},[t,g,null==a?void 0:a.uuid,f]),N=(0,r.useCallback)((e,t)=>{C(),S();let a=e||"Message failed. Please try again.";v(a,{error:new H.LG(a,t||"completion_error",500,{}),errorContext:{tags:{source:"pending_message_recovery"}}})},[C,S,v]),E=(0,r.useCallback)(()=>{if(!(null==x?void 0:x.uuid)||!t||!a)return;M(!0),o.current=new AbortController;let e=0,n=async()=>{var a,i,r;if(e>=10||(null==(a=o.current)?void 0:a.signal.aborted))return void M(!1);e++;try{let e=await fetch("/api/organizations/".concat(x.uuid,"/chat_conversations/").concat(t,"/completion_status?poll=true"),{method:"GET",credentials:"include",signal:null==(i=o.current)?void 0:i.signal});if(!e.ok)return void M(!1);let a=await e.json();a.is_pending?(null==(r=o.current)?void 0:r.signal.aborted)||(d.current=setTimeout(()=>void n(),2e3)):(b(!1),M(!1),C(),a.is_error&&N(a.error_detail,a.error_code),await (0,s.C4)(_,x.uuid,t))}catch(e){M(!1)}};n()},[null==x?void 0:x.uuid,t,a,_,N,C]);return(0,r.useEffect)(()=>{if(!i&&!l.current&&a&&n&&void 0!==j){if(l.current=!0,j.is_error)N(j.error_detail,j.error_code);else if(j.is_pending){b(!0);let e=(0,G.b)();u.current=e;let n={uuid:e,sender:"assistant",content:[{type:"text",text:""}],created_at:new Date().toISOString(),updated_at:new Date().toISOString(),parent_message_uuid:a.uuid,attachments:[],files:[],files_v2:[],sync_sources:[],index:1,metadata:{is_resume_completion_placeholder_message:!0}};m(t,[a,n]),E()}}},[i,a,n,j,N,m,t,E]),(0,r.useEffect)(()=>()=>{w()},[w]),{hasPendingUserMessage:h,isCompletionStatusLoading:!!a&&k&&!y,stopPendingRecovery:()=>M(!1)}}({conversationUuid:o,chatConversationTree:S,pendingUserMessage:eu?void 0:E,isLoading:w});(0,r.useEffect)(()=>{S||w||N||!k||(0,L.BV)()},[S,w,N,k]);let eC=(0,r.useMemo)(()=>{var e,t;return null!=(t=null!=(e=null==u?void 0:u.settings)?e:null==S?void 0:S.settings)?t:{}},[null==u?void 0:u.settings,null==S?void 0:S.settings]);if(!S&&!w&&!N){if(k)return null;(0,p.notFound)()}return(0,n.jsxs)(g.N,{settings:eC,children:[(0,n.jsx)(O.v,{isStreaming:ep||ek,isTemporary:!!(null==u?void 0:u.is_temporary),chatInputDefaultMessage:h,conversationTitle:u?"".concat(u.name," - Claude"):"Claude",conversationUuid:o,isLoading:w||!S&&C||eS,messageUuids:A,name:null!=(l=null!=(i=null==S?void 0:S.name)?i:null==u?void 0:u.name)?l:"Untitled Chat",onSend:eh,onRetry:eb,projectUuid:I,changeDisplayedConversationPath:ej,editMessage:eM,setPersonalizedStyleCallback:es,retryCount:ei,onStopSampling:ek?ew:void 0,isReconnected:e_}),(0,z.F)()&&(0,n.jsx)(D,{})]})}var Q=a(0x1df3358a6),X=a(0x90b81730),Z=a(0x17f3a2521);function W(e){var t,a,d;let{uuid:c,q:m,allowDanglingHumanMessage:f}=e,{data:g,currentPath:x,isLoading:v}=(0,s.Bq)(c,{returnDanglingHumanMessage:f}),p=(0,L.Xi)(e=>e.isInIframe),_=(0,r.useRef)(!1);(0,i.K7)(null!=(a=null==g?void 0:g.name)?a:"");let h=null!=(d=null==g||null==(t=g.messageByUuid)?void 0:t.size)?d:0;return((0,X.V)(c,x||[],v,h),(0,r.useEffect)(()=>{p&&c&&!_.current&&(_.current=!0,(0,L.FU)(c,!1))},[p,c]),(null==g?void 0:g.platform)===Z.P5.CLINT||(null==g?void 0:g.session_id))?(0,n.jsx)(l.default,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.u,{conversationUuid:c,children:(0,n.jsx)(u._,{conversationUuid:c,children:(0,n.jsx)(K,{conversation:g,conversationUuid:c,chatInputDefaultMessage:m,returnDanglingHumanMessage:f})})}),(0,n.jsx)(Q.PaymentVerificationModal,{})]})}},0x1df3358a6:(e,t,a)=>{a.r(t),a.d(t,{PaymentVerificationModal:()=>v});var n=a(0x22102fd88),s=a(0xf32c56dd),i=a(0xa5acf583),r=a(0x14de19ae8),l=a(0x139b5e710),u=a(0x1bdad8807),o=a(0x17185943),d=a(0x183548b63),c=a(0x17e725145),m=a(0xfc89b4a4),f=a(0x38e6572),g=a(0x23e1b1f63),x=a(0x3b58c804);function v(){let[e,t]=(0,m.useState)(!1),a=(0,s.st)(),{activeOrganization:v}=(0,r.YL)(),{addError:p,addSuccess:_}=(0,l.Yf)(),h=(0,i._r)(),b=(0,c.useQueryClient)(),{shouldShowModal:y,dismissReminder:M}=(0,x.F)(),j=(0,g.Si)({onSuccess:async e=>{try{var s,i;let t=await (0,u.nW)(e.entity,h);if(!t)throw Error("Stripe failed to initialize");let r=await t.retrieveSetupIntent(e.clientSecret);if(r.error)throw Error(r.error.message);if((null==(s=r.setupIntent)?void 0:s.status)==="requires_action"){let a=await t.handleNextAction({clientSecret:e.clientSecret});if(a.error)throw Error(a.error.message)}else(null==(i=r.setupIntent)?void 0:i.status)==="succeeded"&&a.track({event_key:"payment_modal_open",organization_id:null==v?void 0:v.uuid,action:"verify_3ds_success_frictionless"});await b.invalidateQueries({queryKey:["check-3ds-required",null==v?void 0:v.uuid]}),a.track({event_key:"payment_modal_open",organization_id:null==v?void 0:v.uuid,action:"verify_3ds_success"}),_((0,n.jsx)(f.A,{defaultMessage:"Payment method verified",id:"OxNDDqJUSV"})),a.track({event_key:"payment_modal_open",organization_id:null==v?void 0:v.uuid,action:"verify_3ds_success"})}catch(e){p(e instanceof Error?"PAYMENT_VERIFICATION_FAILED"===e.message?(0,n.jsx)(f.A,{defaultMessage:"Payment verification failed",id:"9RpX03Q2ky"}):e.message.includes("Failed to redirect to https://hooks.stripe.com")||e.message.includes("3d_secure")||e.message.includes("hooks.stripe.com")?(0,n.jsx)(f.A,{defaultMessage:"Unable to complete payment verification. Check if pop-ups are blocked or try a different browser.",id:"sDFdJ5I8X1"}):e.message:(0,n.jsx)(f.A,{defaultMessage:"Payment verification failed. Please try again.",id:"0kXa3Rf5bZ"}),{error:e,errorContext:{tags:{source:"payment_verification"}}}),a.track({event_key:"payment_modal_open",organization_id:null==v?void 0:v.uuid,action:"verify_3ds_error",error_message:e instanceof Error?e.message:"Unknown error"})}finally{t(!1)}},onError:e=>{t(!1),p((0,n.jsx)(f.A,{defaultMessage:"Failed to start verification process. Please try again.",id:"3dT/r8rV5S"}),{error:e}),a.track({event_key:"payment_modal_open",organization_id:null==v?void 0:v.uuid,action:"verify_3ds_api_error",error_message:e.message})}}),k=()=>{M()};return y?(0,n.jsx)(d.aF,{isOpen:y,onClose:k,modalSize:"md",hasCloseButton:!0,title:(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsx)(o.E,{color:"secondary",size:"lg",children:(0,n.jsx)(f.A,{defaultMessage:"Action Required",id:"jWgFDt2Ifa"})})}),children:(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h2",{className:"text-3xl font-medium text-text-100 mb-3",children:(0,n.jsx)(f.A,{defaultMessage:"Verify your payment method",id:"epYApo9bIj"})}),(0,n.jsx)("p",{className:"text-text-200 mb-6",children:(0,n.jsx)(f.A,{defaultMessage:"To comply with European security regulations, we need to verify your payment method using a quick one-time security process. This ensures your subscription remains active and secure.",id:"K0hDpiUx0B"})}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 mt-6",children:[(0,n.jsx)(d.yl,{onClick:()=>{t(!0),a.track({event_key:"payment_modal_open",organization_id:null==v?void 0:v.uuid,action:"verify_3ds_start"});let e=window.location.href;j.mutate({return_url:e})},loading:e,className:"w-full",children:(0,n.jsx)(f.A,{defaultMessage:"Verify now",id:"t28SE7zKVA"})}),(0,n.jsx)(d.yl,{variant:"secondary",onClick:k,className:"w-full",children:(0,n.jsx)(f.A,{defaultMessage:"Remind me later",id:"c4hRLOnYpQ"})})]})]})}):null}}}]);
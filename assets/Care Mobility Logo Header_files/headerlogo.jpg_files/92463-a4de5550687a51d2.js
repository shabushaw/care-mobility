try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d75c3b58-6875-4e54-9927-a93bd2922eda",e._sentryDebugIdIdentifier="sentry-dbid-d75c3b58-6875-4e54-9927-a93bd2922eda")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[92463],{0xf071fd84:(e,t,a)=>{a.d(t,{Ns:()=>u,XJ:()=>d,mt:()=>c,r$:()=>i,rz:()=>f});var n=a(0x12c9046cd),s=a(0x14de19ae8),l=a(0xac309a83),r=a(0x17e725145);let o="artifact_tool_configuration",i="artifact_storage_info",c=e=>{let{entityId:t,artifactEntityType:a,conversationUuid:r,filePath:i}=e,{activeOrganization:c}=(0,s.YL)(),d=null==c?void 0:c.uuid,u=(0,l.fS)("claude_create_marble"),f="/api/organizations/".concat(d,"/artifacts/").concat(a,"/").concat(t,"/tools"),h=new URLSearchParams;r&&h.set("chat_conversation_uuid",r),i&&h.set("file_path",i);let m=h.toString(),g=m?"".concat(f,"?").concat(m):f,x="wiggle_artifact"!==a||!!r&&!!i;return(0,n.Sk)(g,{queryKey:[o,{orgUuid:d,entityId:t,artifactEntityType:a,conversationUuid:r,filePath:i}],enabled:!!d&&!!t&&u&&x,meta:{noToast:!0}})},d=e=>{let{entityId:t,artifactEntityType:a,conversationUuid:i,filePath:c}=e,{activeOrganization:d}=(0,s.YL)(),u=null==d?void 0:d.uuid,f=(0,r.useQueryClient)(),h=(0,l.fS)("claude_create_marble"),m="/api/organizations/".concat(u,"/artifacts/").concat(a,"/").concat(t,"/tools"),g=new URLSearchParams;i&&g.set("chat_conversation_uuid",i),c&&g.set("file_path",c);let x=g.toString(),p=x?"".concat(m,"?").concat(x):m;return(0,n.L2)(p,"POST",{enabled:!!u&&!!t&&h,onSuccess:()=>{f.invalidateQueries({queryKey:[o,{orgUuid:u,entityId:t,artifactEntityType:a,conversationUuid:i,filePath:c}]})},meta:{noToast:!0}})},u=(e,t)=>{var a;let{entityId:r,artifactEntityType:o,conversationUuid:c,filePath:d}=e,{activeOrganization:u}=(0,s.YL)(),f=null==u?void 0:u.uuid,h=(0,l.fS)("claude_create_pebble_stone"),m="/api/organizations/".concat(f,"/artifacts/").concat(o,"/").concat(r,"/manage/storage/info"),g=new URLSearchParams;c&&g.set("chat_conversation_uuid",c),d&&g.set("file_path",d);let x=g.toString(),p=x?"".concat(m,"?").concat(x):m;return(0,n.Sk)(p,{queryKey:[i,{orgUuid:f,entityId:r,artifactEntityType:o,conversationUuid:c,filePath:d}],enabled:!!f&&!!r&&h&&(null==(a=null==t?void 0:t.enabled)||a),staleTime:0,meta:{noToast:!0}})},f=e=>{let{entityId:t,artifactEntityType:a,conversationUuid:o,filePath:c}=e,{activeOrganization:d}=(0,s.YL)(),u=null==d?void 0:d.uuid,f=(0,r.useQueryClient)(),h=(0,l.fS)("claude_create_pebble_stone"),m="/api/organizations/".concat(u,"/artifacts/").concat(a,"/").concat(t,"/manage/storage/reset"),g=new URLSearchParams;o&&g.set("chat_conversation_uuid",o),c&&g.set("file_path",c);let x=g.toString(),p=x?"".concat(m,"?").concat(x):m;return(0,n.L2)(p,"DELETE",{enabled:!!u&&!!t&&h,onSuccess:()=>{f.invalidateQueries({queryKey:[i,{orgUuid:u,entityId:t,artifactEntityType:a,conversationUuid:o,filePath:c}]})},meta:{noToast:!0}})}},0x1575c7741:(e,t,a)=>{a.d(t,{f:()=>i});var n=a(0x14de19ae8),s=a(0x139b5e710),l=a(0xac309a83),r=a(0xfc89b4a4),o=a(0x1ab0d1ca1);let i=function(){let{artifactContext:e,onRateLimitError:t,onMissingOrganization:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,l.fS)("apps_use_turmeric"),{activeOrganization:c}=(0,n.YL)(),{addError:d}=(0,s.Yf)(),u=(0,o.A)();return(0,r.useCallback)(async n=>{if(!i)return Promise.resolve(null);if(!(null==c?void 0:c.uuid))return null==a||a(),Promise.resolve(null);try{var s;let a=await fetch("/api/organizations/".concat(null==c?void 0:c.uuid,"/proxy/v1/messages"),{method:"POST",headers:{"Content-Type":"application/json",...e?{"anthropic-artifact-id":e.uuid,"anthropic-artifact-entity-type":e.type}:{}},body:JSON.stringify({messages:[{role:"user",content:n}]})});if(!a.ok)throw 429===a.status&&(t?t():d(u.formatMessage({defaultMessage:"Limit reached. This artifact uses Claude for responses. Try again when the message limit resets.",id:"5Ocu9uCFLz"}),{messageForLogging:"Limit reached. This artifact uses Claude for responses. Try again when the message limit resets."})),Error("HTTP error! status: ".concat(a.status));let l=await a.json();return Promise.resolve((null==(s=l.content[0])?void 0:s.text)||null)}catch(e){return Promise.reject(e)}},[null==c?void 0:c.uuid,e,i,t,a,d,u])}},0x1bb0f43cc:(e,t,a)=>{a.d(t,{j:()=>r});var n=a(0x14de19ae8),s=a(0xac309a83),l=a(0xfc89b4a4);let r=function(){let{artifactContext:e,onMissingOrganization:t,chatConversationUuid:a,onStorageChange:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:o}=(0,n.YL)(),i=(0,s.fS)("claude_create_pebble_stone"),c=(0,l.useCallback)(async function(n){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(null==o?void 0:o.uuid))return null==t||t(),Promise.resolve(null);if(!i||!e)return Promise.resolve(null);try{let t=new URL("/api/organizations/".concat(o.uuid,"/artifacts/").concat(e.type,"/").concat(e.uuid,"/storage/").concat(encodeURIComponent(n)),window.location.origin);t.searchParams.set("shared",s.toString()),a&&t.searchParams.set("chat_conversation_uuid",a),e.file_path&&t.searchParams.set("file_path",e.file_path);let l=await fetch(t.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok)throw Error("Database error: ".concat(l.status));let r=await l.json();return Promise.resolve(r)}catch(e){return Promise.reject(e)}},[i,null==o?void 0:o.uuid,e,t,a]),d=(0,l.useCallback)(async function(n,s){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(null==o?void 0:o.uuid))return null==t||t(),Promise.resolve(null);if(!i||!e)return Promise.resolve(null);try{let t=await fetch("/api/organizations/".concat(o.uuid,"/artifacts/").concat(e.type,"/").concat(e.uuid,"/storage/").concat(encodeURIComponent(n)),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:s,shared:l,...a&&{chat_conversation_uuid:a},...e.file_path&&{file_path:e.file_path}})});if(!t.ok)throw Error("Database error: ".concat(t.status));let i=await t.json();return null==r||r(),Promise.resolve(i)}catch(e){return Promise.reject(e)}},[i,null==o?void 0:o.uuid,e,t,a,r]),u=(0,l.useCallback)(async function(n){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(null==o?void 0:o.uuid))return null==t||t(),Promise.resolve(null);if(!i||!e)return Promise.resolve(null);try{let t=new URL("/api/organizations/".concat(o.uuid,"/artifacts/").concat(e.type,"/").concat(e.uuid,"/storage/").concat(encodeURIComponent(n)),window.location.origin);t.searchParams.set("shared",s.toString()),a&&t.searchParams.set("chat_conversation_uuid",a),e.file_path&&t.searchParams.set("file_path",e.file_path);let l=await fetch(t.toString(),{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!l.ok)throw Error("Database error: ".concat(l.status));let i=await l.json();return null==r||r(),Promise.resolve(i)}catch(e){return Promise.reject(e)}},[i,null==o?void 0:o.uuid,e,t,a,r]),f=(0,l.useCallback)(async function(n){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(null==o?void 0:o.uuid))return null==t||t(),Promise.resolve(null);if(!i||!e)return Promise.resolve(null);try{let t=new URL("/api/organizations/".concat(o.uuid,"/artifacts/").concat(e.type,"/").concat(e.uuid,"/storage"),window.location.origin);n&&t.searchParams.set("prefix",n),t.searchParams.set("shared",s.toString()),a&&t.searchParams.set("chat_conversation_uuid",a),e.file_path&&t.searchParams.set("file_path",e.file_path);let l=await fetch(t.toString(),{method:"GET",headers:{"Content-Type":"application/json"}});if(!l.ok)throw Error("Database error: ".concat(l.status));let r=await l.json();return Promise.resolve(r)}catch(e){return Promise.reject(e)}},[i,null==o?void 0:o.uuid,e,t,a]);return{get:c,set:d,delete:u,list:f}}},0x1bf083d8d:(e,t,a)=>{a.d(t,{I:()=>z});var n=a(0x22102fd88),s=a(0x303b360c),l=a(0x139b5e710),r=a(0x17185943),o=a(0x246846ae8),i=a(0x2471dc42f),c=a(0x1b6318607),d=a(0x19c88845),u=a(0x225bae024),f=a(0x1cd2ec21c),h=a(0x183548b63),m=a(0x22fc8d729),g=a(0x1b370f49d),x=a(0x10b8a0309),p=a(0x761f2ec),v=a(0x1a1f6dda6),b=a(0x4d348f95),y=a(0xfc89b4a4),j=a(0x1ab0d1ca1),w=a(0x38e6572),_=a(0xf071fd84),C=a(0x22be9474c),k=a(0x4d9fc74e),S=a(0x31c535e9),M=a(0x1d1a079e9),N=a(0x1037073d3),E=a(0x21edecce6),A=a(0xe824fb1c),P=a(0x6f6d4bd7);function T(e){let{className:t,...a}=e;return(0,n.jsx)("div",{...a,className:(0,v.A)("bg-bg-000 border-0.5 border-border-300 rounded-lg shadow-sm p-5 flex flex-col gap-4 items-stretch self-stretch",t)})}let R=e=>{let{isOpen:t,onClose:a,variant:s,unknownServerCount:l}=e,r=(0,j.A)();return(0,n.jsxs)(h.aF,{title:r.formatMessage({defaultMessage:"Connectors unavailable",id:"nKB/o0ajrR"}),isOpen:t,onClose:a,children:[(0,n.jsx)("div",{className:"flex flex-col gap-3 py-3",children:(0,n.jsx)(T,{children:(0,n.jsx)("p",{className:"text-sm text-text-500",children:"disabled"===s?(0,n.jsx)(w.A,{defaultMessage:"Your organization admin has disabled connectors in artifacts. To use this feature, ask your admin to enable connectors in artifacts.",id:"+0AXIvgEHO"}):(0,n.jsx)(w.A,{defaultMessage:"{count, plural, one {# requested connector is not in your directory and has been} other {# requested connectors are not in your directory and have been}} hidden. Some functionality may be limited. {link}",id:"BwbZlzhj12",values:{count:l||0,link:(0,n.jsx)(m.Y,{href:"/settings/connectors",children:(0,n.jsx)(w.A,{defaultMessage:"Manage connectors.",id:"0+FF8HZw5G"})})}})})})}),(0,n.jsx)(h.vW,{children:(0,n.jsx)(u.$,{variant:"primary",onClick:a,children:(0,n.jsx)(w.A,{defaultMessage:"Close",id:"rbrahOGMC3"})})})]})},L=e=>{var t,a,s;let{server:l,variant:o,onClick:c,enabledToolsCount:f,artifactId:h,versionUuid:p,isInDirectory:b=!1,onToggleAll:j,pendingAfterOAuth:_=!1}=e,C=(0,k.QD)({queryString:h?"artifactId=".concat(encodeURIComponent(h),"&versionUuid=").concat(encodeURIComponent(p||"")):""}),[S,M]=(0,y.useState)(!1),E=S||l.isConnecting||_||!1;return(0,y.useEffect)(()=>{l.isConnected&&M(!1)},[l.isConnected]),(0,n.jsxs)("div",{className:(0,v.A)("w-full flex items-center justify-between rounded-lg bg-bg-000",c&&"connect"!==o&&"unavailable"!==o&&"loading"!==o&&"cursor-pointer hover:bg-bg-100 transition-colors"),onClick:"connect"===o||"unavailable"===o||"loading"===o?void 0:c,children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,n.jsx)(N.z,{size:28,imageSize:16,type:"favicon",src:l.url,name:l.name||l.url}),(0,n.jsxs)("div",{className:"flex gap-2 items-center min-w-0 flex-1",children:[(0,n.jsx)(g.m,{tooltipContent:l.url||l.name||"",children:(0,n.jsx)("div",{className:"font-medium text-sm truncate",children:l.name||l.url||""})}),!b&&(0,n.jsx)(r.E,{className:"flex-shrink-0",children:(0,n.jsx)(w.A,{defaultMessage:"CUSTOM",id:"Jg/zGahNtM"})})]})]}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:"connect"===o?(0,n.jsx)(u.$,{variant:"secondary",size:"sm",onClick:e=>{e.stopPropagation(),M(!0),C({uuid:l.uuid||"",url:l.url})},loading:E,className:"ml-2",children:(0,n.jsx)(w.A,{defaultMessage:"Connect",id:"+vVZ/G11Zg"})}):"loading"===o?(0,n.jsx)(u.$,{variant:"secondary",size:"sm",loading:!0,disabled:!0,className:"ml-2",children:(0,n.jsx)(w.A,{defaultMessage:"Connecting",id:"6q3tCnkd2h"})}):"unavailable"===o?(0,n.jsxs)("div",{className:"flex items-center gap-1 ml-2",children:[(0,n.jsx)(u.$,{variant:"secondary",size:"sm",disabled:!0,children:(0,n.jsx)(w.A,{defaultMessage:"Unavailable",id:"UpwcFdTuii"})}),(0,n.jsx)(g.m,{tooltipContent:(0,n.jsx)(w.A,{defaultMessage:"Manage connectors",id:"cqx+RdJnHp"}),children:(0,n.jsx)(m.Y,{href:"/settings/connectors",className:"text-fg-400 hover:text-fg-300 transition-colors p-1",children:(0,n.jsx)(d.ArrowOutSquare,{className:"w-4 h-4"})})})]}):"toggle"===o?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("label",{onClick:e=>e.stopPropagation(),children:(0,n.jsx)(i.j,{checked:f===((null==(t=l.tools)?void 0:t.length)||0)&&((null==(a=l.tools)?void 0:a.length)||0)>0,onChange:()=>{var e;let t=(null==(e=l.tools)?void 0:e.length)||0,a=f===t&&t>0;null==j||j(!a)}})}),(0,n.jsx)(x.J,{className:"w-4 h-4 text-fg-400"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.E,{children:(0,n.jsx)("span",{className:"text-accent-secondary-200",children:(0,n.jsx)(w.A,{defaultMessage:"{enabled} of {total}",id:"ln8LiF3/8T",values:{enabled:f,total:(null==(s=l.tools)?void 0:s.length)||0}})})}),(0,n.jsx)(x.J,{className:"w-4 h-4 text-fg-400"})]})})]})},z=e=>{let{isOpen:t,requestedServers:a,onClose:r,artifactContext:i}=e,g=(0,j.A)(),x=(0,A.Uz)(),v=(0,E.p)(),k=(0,b.useSearchParams)(),N=k.get("server"),z="success"===k.get("step")&&!!N,{addError:I}=(0,l.Yf)(),O=g.formatMessage({defaultMessage:"Failed to save tool configuration. Please try again.",id:"ZohwwHXd08"}),{data:U}=(0,C.rX)(),D=!(null==U?void 0:U.disabled_features.includes("mcp_artifacts")),[F,K]=(0,y.useState)(null),[$,Y]=(0,y.useState)(""),[q,H]=(0,y.useState)({}),{data:B}=(0,_.mt)({entityId:i.uuid,artifactEntityType:i.type,conversationUuid:i.conversation_uuid,filePath:i.file_path}),{connectorServers:J,directoryServers:X,unknownServers:Z}=(0,y.useMemo)(()=>{if(!x)return{connectorServers:[],directoryServers:[],unknownServers:[]};let e=[...a||[]],t=new Set((null==a?void 0:a.map(e=>e.url).filter(Boolean))||[]);(null==B?void 0:B.mcp_servers)&&B.mcp_servers.forEach(a=>{t.has(a.url)||e.push({name:a.name,url:a.url})});let n=[],s=[],l=[];return e.forEach(e=>{let t=x.find(t=>{var a,n;let s="remote"===t.type,l=null==(a=t.url)?void 0:a.replace(/\/$/,""),r=null==(n=e.url)?void 0:n.replace(/\/$/,"");return s&&l===r});t?n.push({...t,isInDirectory:!!t.directoryMetadata}):v.some(t=>(0,P._c)(t,e.url))?s.push(e):l.push(e)}),{connectorServers:n,directoryServers:s,unknownServers:l}},[a,x,B,v]),G=(0,S.vP)("enabled_mcp_tools"),Q=(0,y.useMemo)(()=>G||{},[G]),{mutateAsync:W}=(0,_.XJ)({entityId:i.uuid,artifactEntityType:i.type,conversationUuid:i.conversation_uuid,filePath:i.file_path}),V=(0,y.useCallback)(e=>e.tools?$?e.tools.filter(e=>e.name.toLowerCase().includes($.toLowerCase())):e.tools:[],[$]);if((0,y.useEffect)(()=>{if((null==B?void 0:B.mcp_servers)&&(null==J?void 0:J.length)){let e={};B.mcp_servers.forEach(t=>{let a=J.find(e=>{var a,n;return(null==(a=e.url)?void 0:a.replace(/\/$/,""))===(null==(n=t.url)?void 0:n.replace(/\/$/,""))});(null==a?void 0:a.tools)&&a.tools.forEach(a=>{let n=t.allowed_tools.includes(a.name);e[a.enabledKey]=n})}),H(e)}else Object.keys(Q).length>0&&H(Q)},[B,J,Q]),!J.length&&!X.length&&!Z.length)return r(),null;if(!J.length&&!X.length)return(0,n.jsx)(R,{isOpen:t,onClose:r,variant:"empty",unknownServerCount:Z.length});let ee=J.filter(e=>e.isConnected),et=e=>e.tools&&0!==e.tools.length?e.tools.filter(e=>!1!==q[e.enabledKey]).length:null,ea=ee.filter(e=>{let t=et(e);return null!==t&&t>0}).length,en=async e=>{try{await es(e),r()}catch(e){I(O,{error:e,errorContext:{tags:{source:"artifact_mcp_tool_config_save"}}})}},es=async e=>{let t=J.map(t=>{let a=t.tools||[],n=[],s=[],l=t.isConnected;return e&&a.length>0&&l?a.forEach(e=>{!1!==q[e.enabledKey]?n.push(e.name):s.push(e.name)}):!e&&a.length>0&&a.forEach(e=>{s.push(e.name)}),{name:t.name||"",url:t.url||"",allowed_tools:n,disallowed_tools:s,pending_tool_section:!!e&&!l}}),a=[...X,...Z].map(e=>({name:e.name||"",url:e.url||"",allowed_tools:[],disallowed_tools:[],pending_tool_section:!1}));await W({mcp_servers:[...t,...a]})},el=e=>!!e.tools&&0!==e.tools.length&&e.tools.filter(e=>!1!==q[e.enabledKey]).length>0;return F?(0,n.jsx)(h.aF,{title:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>K(null),className:"hover:bg-bg-200 rounded transition-colors",children:(0,n.jsx)(p.A,{className:"w-5 h-5"})}),(0,n.jsx)("span",{children:(0,n.jsx)(w.A,{defaultMessage:"Customize {serverName}",id:"xtLJnxdHqO",values:{serverName:F.name||F.url||""}})})]}),isOpen:t,onClose:r,children:(0,n.jsxs)("div",{className:"flex flex-col gap-3 py-3",children:[(0,n.jsx)("p",{className:"text-sm description-text-300",children:(0,n.jsx)(c.YX,{id:"crystal_muffin_bicycle"})}),(0,n.jsx)(f.r,{gradientHeight:24,className:"max-h-[500px]",children:(0,n.jsxs)(T,{className:"!gap-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2.5 px-1.5",children:[(0,n.jsx)(d.Search,{className:"w-4 h-4 text-text-500/50"}),(0,n.jsx)(o.ks,{placeholder:g.formatMessage({defaultMessage:"Search tools",id:"QVlai1/dYD"}),value:$,onChange:e=>Y(e.target.value),className:"flex-1 !border-none !outline-none !p-0 !text-sm text-text-300 placeholder:text-text-500/70"})]}),F.tools&&F.tools.length>1&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(M.$,{item:{key:"select-all",type:"switch",label:el(F)?g.formatMessage({defaultMessage:"Disable all tools",id:"8A9N39nihk"}):g.formatMessage({defaultMessage:"Enable all tools",id:"x4/g36jIjW"}),icon:(0,n.jsx)(s.p,{letter:F.tools[0].name,size:16}),isChecked:el(F),onClick:()=>{let e=!el(F);if(F.tools){let t={...q};F.tools.forEach(a=>{t[a.enabledKey]=e}),H(t)}}}}),(0,n.jsx)("div",{className:"border-t border-border-300"})]}),V(F).map(e=>{let t=e.enabledKey,a=!1!==q[t];return(0,n.jsx)(M.$,{item:{key:t,type:"switch",label:e.name,icon:(0,n.jsx)(s.B,{letter:e.name,size:16}),isChecked:a,onClick:()=>{H(e=>({...e,[t]:!a}))}}},t)})]})})]})}):D?(0,n.jsxs)(h.aF,{title:g.formatMessage({defaultMessage:"Allow access to connectors",id:"5yCBRk9i5t"}),isOpen:t,onClose:r,children:[(0,n.jsxs)("div",{className:"flex flex-col gap-3 py-3",children:[(0,n.jsx)("p",{className:"text-sm description-text-300",children:(0,n.jsx)(c.YX,{id:"penguin_tomato_umbrella"})}),(0,n.jsx)(f.r,{gradientHeight:24,className:"max-h-[500px]",children:(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsxs)(T,{children:[J.map(e=>{var t;let a,s=ee.includes(e),l=z&&e.uuid===N&&!s,r=e.isConnecting||l||!1,o=et(e),c=(null==(t=e.tools)?void 0:t.length)||0;return a=r?"loading":s?0===o||o===c?"toggle":"tools":"connect",(0,n.jsx)(L,{server:e,variant:a,onClick:()=>K(e),enabledToolsCount:o,artifactId:i.id,versionUuid:i.uuid,isInDirectory:!!e.isInDirectory,onToggleAll:t=>((e,t)=>{if(e.tools){let a={...q};e.tools.forEach(e=>{a[e.enabledKey]=t}),H(a)}})(e,t),pendingAfterOAuth:l},e.uuid||e.url)}),X.length>0&&(0,n.jsxs)(n.Fragment,{children:[J.length>0&&(0,n.jsx)("div",{className:"border-t-0.5 border-border-300 -mx-5"}),X.map(e=>(0,n.jsx)(L,{server:e,variant:"unavailable",isInDirectory:!0},e.url))]}),Z.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"border-t-0.5 border-border-300 -mx-5"}),(0,n.jsx)("p",{className:"text-xs text-text-500",children:(0,n.jsx)(w.A,{defaultMessage:"{count, plural, one {# requested connector is not in your directory and has been} other {# requested connectors are not in your directory and have been}} hidden. Some functionality may be limited. {link}",id:"BwbZlzhj12",values:{count:Z.length,link:(0,n.jsx)(m.Y,{href:"/settings/connectors",children:(0,n.jsx)(w.A,{defaultMessage:"Manage connectors.",id:"0+FF8HZw5G"})})}})})]})]}),(0,n.jsx)(T,{className:"bg-bg-100",children:(0,n.jsx)("p",{className:"text-sm text-text-500",children:(0,n.jsx)(w.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})})]})})]}),(0,n.jsx)(h.vW,{children:ea>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.$,{variant:"secondary",onClick:r,children:(0,n.jsx)(w.A,{defaultMessage:"Not now",id:"dUCA4Khx0S"})}),(0,n.jsx)(u.$,{onClick:()=>en(!0),variant:"primary",children:(0,n.jsx)(w.A,{defaultMessage:"Continue with {count, plural, one {# connector} other {# connectors}}",id:"YL3kaz513s",values:{count:ea}})})]}):(0,n.jsx)(u.$,{onClick:()=>en(!0),variant:"primary",children:(0,n.jsx)(w.A,{defaultMessage:"Continue without connectors",id:"0AAuZbbfFT"})})})]}):(0,n.jsx)(R,{isOpen:t,onClose:r,variant:"disabled"})}},0x202fabf16:(e,t,a)=>{a.d(t,{CodeRenderer:()=>A,k:()=>E,MarkdownRenderer:()=>P});var n=a(0x22102fd88),s=a(0x209ff4fac),l=a(0x11307af4f),r=a(0xbca8e388),o=a(0xda044f84),i=a(0x236236dc),c=a(0x1f725a926),d=a(0x112f760bb),u=a(0x24fcf6beb),f=a(0xc5b8d95e),h=a(0x1a1f6dda6),m=a(0xfc89b4a4),g=a(0x239a63c1c),x=a(0xf32c56dd),p=a(0x1cf5ab98a),v=a(0x19c88845),b=a(0xb844abc8),y=a(0x160045b25),j=a(0x18c2bb2d),w=a(0x1ab0d1ca1),_=a(0x38e6572);let C=e=>{let{isStreaming:t,children:a,...s}=e;return t?a:(0,n.jsx)(k,{...s,children:a})},k=e=>{let{children:t,sendMessage:a,contentType:s="text",isOpen:l}=e,r=(0,w.A)(),o=(0,x.st)(),i=void 0!==a,[c,d]=(0,m.useState)([]),[u,f]=(0,m.useState)({top:0,left:0,width:0}),[g,C]=(0,m.useState)(!1),[k,S]=(0,m.useState)(!1),[M,N]=(0,m.useState)(""),[E,A]=(0,m.useState)(""),[P,T]=(0,m.useState)(!1),R=(0,m.useRef)(null),L=(0,m.useRef)(null),z=(0,m.useCallback)((e,t)=>{var a;let n=function(e,t){let a=[];for(let n=0;n<e.rangeCount;n++){let s=e.getRangeAt(n);if(s.startContainer===s.endContainer&&s.startContainer.nodeType===Node.TEXT_NODE){let e=s.startContainer,t=document.createRange();for(let n=s.startOffset;n<s.endOffset;n++){t.setStart(e,n),t.setEnd(e,n+1);let s=Array.from(t.getClientRects());a.push(...s)}t.detach()}else{let e=function(e){let t,a=[],n=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,t=>e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);for(;t=n.nextNode();)a.push(t);return a}(s);e.forEach((n,l)=>{let r=document.createRange(),o="length"in n?n.length:0,i=0===l,c=l===e.length-1,d=i?s.startOffset:0,u=c&&!t?s.endOffset:o;r.setStart(n,d),r.setEnd(n,u);let f=Array.from(r.getClientRects());a.push(...f),r.detach()})}}return a}(e,t),s=null==(a=R.current)?void 0:a.getBoundingClientRect();return Array.from(n).map(e=>({top:e.top-((null==s?void 0:s.top)||0)-2.5,left:e.left-((null==s?void 0:s.left)||0),width:e.width,height:e.height+5.5}))},[]),I=(0,m.useCallback)(e=>{var t;let a=e.getRangeAt(0);return null==(t=R.current)?void 0:t.contains(a.commonAncestorContainer)},[]);(0,m.useEffect)(()=>{function e(e){var t,a,n,s;let l,r,{selection:o,isSelectAll:i}=e,c=z(o,i);if(c.every((e,t,a)=>0===t||5>Math.abs(e.top-a[0].top))){let e=Math.max(...c.map(e=>e.left+e.width));l=c[0].top-9,r=e+10}else{let e=Math.max(...c.map(e=>e.top+e.height));r=Math.min(...c.map(e=>e.left)),l=Math.min((null!=(n=null==(a=R.current)?void 0:a.scrollHeight)?n:0)-50,e)}let u=((null!=(s=null==(t=R.current)?void 0:t.scrollWidth)?s:1e3)-r)/3*2;d(c),C(!0),S(!1),f({top:l,left:r,width:u}),A(o.toString())}let t=()=>{T(!0)},a=t=>{"Escape"===t.key&&(S(!1),C(!1),N(""),d([]));let a=((0,b.cX)()?t.metaKey:t.ctrlKey)&&"a"===t.key,n=R.current;if(n&&l&&a){let a=document.activeElement&&(document.activeElement===n||(null==n?void 0:n.contains(document.activeElement))),s=window.getSelection();if(a&&s){t.preventDefault();let a=document.createRange();a.selectNodeContents(n),s.removeAllRanges(),s.addRange(a),e({selection:s,isSelectAll:!0})}}},n=t=>{if(L.current&&L.current.contains(t.target))return;let a=window.getSelection();a&&!a.isCollapsed&&I(a)?e({selection:a}):(d([]),C(!1),S(!1),A(""),N("")),T(!1)};return i&&(document.addEventListener("mousedown",t),document.addEventListener("mouseup",n),document.addEventListener("keydown",a)),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("mouseup",n),document.removeEventListener("keydown",a)}},[z,I,i,l]);let O=e=>{i&&(a(e),N(""),S(!1),C(!1),d([]))},U=()=>"text"===s?E.split("\n").map(e=>"> ".concat(e)).join("\n"):"code"===s?"```\n".concat(E,"\n```"):void 0,D=()=>{O({prompt:"".concat(U(),"\n\n").concat(M),attachments:[],files:[],syncSources:[]})};return(0,n.jsxs)("div",{className:"w-full h-full relative",children:[(0,n.jsx)("div",{ref:R,tabIndex:0,className:(0,h.$)("w-full h-full relative",i?P?"[&_:not(input)::selection]:bg-secondary-000/10":"[&_*::selection]:bg-secondary-000/10":""),children:t}),c.map((e,t)=>(0,n.jsx)("div",{className:"absolute pointer-events-none bg-accent-secondary-000/10",style:{top:e.top,left:e.left,width:e.width,height:e.height}},t)),(0,n.jsx)(y.N,{children:g&&!k&&(0,n.jsx)(j.P.div,{className:"absolute z-10",initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",damping:30,stiffness:400,delay:.2},style:{top:u.top+5,left:u.left},children:(0,n.jsx)("div",{className:"border-0.5 flex items-center rounded-lg px-2 pb-1 pt-3 shadow transition bg-bg-000 text-text-400 border-border-300",children:(0,n.jsxs)("div",{className:"-mx-1 -mt-2 flex items-stretch justify-between gap-0.5",children:[(0,n.jsx)(p.$,{variant:"ghost",size:"sm",className:"!font-base",onClick:()=>{o.track({event_key:"artifactinlinefeedback.selection.clicked",source:"improve"}),S(!0)},prepend:(0,n.jsx)(v.Prompt,{}),children:(0,n.jsx)(_.A,{defaultMessage:"Improve",id:"BATKcMm/a2"})}),(0,n.jsx)(p.$,{variant:"ghost",size:"sm",className:"!font-base",onClick:()=>{o.track({event_key:"artifactinlinefeedback.selection.clicked",source:"explain"}),O({prompt:"".concat(r.formatMessage({defaultMessage:"Can you explain this section to me in more detail?",id:"LMDbiRxyDQ"}),"\n\n").concat(U()),attachments:[],files:[],syncSources:[]})},prepend:(0,n.jsx)(v.Lightbulb,{}),children:(0,n.jsx)(_.A,{defaultMessage:"Explain",id:"HGdgPPM2Ry"})})]})})})}),(0,n.jsx)(y.N,{children:k&&(0,n.jsxs)(j.P.form,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{type:"spring",damping:30,stiffness:400},className:"z-10 absolute flex gap-2 p-2 pl-4 items-center h-12 rounded-lg bg-bg-000 text-text-200 border border-0.5 border-border-300 shadow-xl",style:{top:u.top+5,left:u.left,width:u.width},ref:L,onSubmit:e=>{e.preventDefault(),D()},children:[(0,n.jsx)("input",{type:"text",value:M,onChange:e=>N(e.target.value),placeholder:r.formatMessage({defaultMessage:"Describe what you would like to update...",id:"smio7jldoW"}),className:"py-0.5 px-0 border-0 bg-transparent text-sm grow !shadow-none text-text-200 placeholder-text-500 hide-focus-ring",autoFocus:!0}),(0,n.jsx)(y.N,{children:M.trim().length>0?(0,n.jsx)(j.P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{type:"spring",damping:30,stiffness:400,delay:0},children:(0,n.jsx)(p.$,{onClick:()=>D(),"aria-label":r.formatMessage({defaultMessage:"Send Message",id:"yJAKR0Ngpn"}),type:"submit",children:(0,n.jsx)("div",{className:"flex items-center gap-2 select-none",children:(0,n.jsx)(_.A,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})}):null})]})})]})};var S=a(0x253ff6d66),M=a(0x1ce8093a4);let N="opacity-30 blur-[2px]",E=e=>{let{isOpen:t,content:a,language:s,citations:l,type:r,showRaw:o,richSandboxRef:i,isCurrentStreaming:c,isChatStreaming:f,onSandboxConfirmation:g,onDOMContentLoaded:x,sendMessage:p,richSandboxCapabilities:v,isLatestVersion:b,artifactId:y,artifactContext:j,artifactVersion:w,onArtifactRuntimeError:_,artifact:C,hasMenuOpen:k,zoom:E,onTrackInteraction:R,showLoginModal:L,ArtifactMcpModal:z}=e,I=void 0!==r&&void 0!==a&&r!==u.vU.Code&&r!==u.vU.Markdown,O=(0,m.useRef)(null),U=I&&!o,[D,F]=(0,m.useState)(null),K=(0,m.useCallback)(e=>{void 0!==y&&void 0!==w&&(void 0!==_&&_(e),F({error:e,artifactId:y,artifactVersion:w}))},[y,w,_]);(0,m.useEffect)(()=>{var e;if(!C||!c)return;let t=C.versions[C.versions.length-1],a=C.versions[C.versions.length-2];if(!a||!t||"update"!==t.command)return;let n=T(a.resultState,t.resultState);-1!==n&&(null==(e=O.current)||e.scrollToPercentage(n/100))},[a,C,c]),(0,m.useEffect)(()=>{!c&&O.current&&O.current.enableScrolling()},[c]);let $=(0,m.useCallback)(()=>{F(e=>e&&(e.artifactId!==y||e.artifactVersion!==w)?null:e)},[y,w]),Y=(0,m.useCallback)(()=>{F(null)},[]);return(0,n.jsxs)(n.Fragment,{children:[I&&(0,n.jsxs)("div",{className:(0,h.A)("ease-out duration-200",U?"h-full w-full relative border-none":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",k&&N),children:[(0,n.jsx)(M.A,{ref:i,className:U?"h-full w-full border-none bg-bg-100":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none",content:U?a:void 0,type:U?r:void 0,onSandboxConfirmation:g,onDOMContentLoaded:x,capabilities:v,onReportError:K,onSetContent:$,onRefresh:Y,externalLinkBehavior:"ask",zoom:E,onTrackInteraction:R,showLoginModal:L,artifactContext:j,ArtifactMcpModal:z,isChatStreaming:f}),U&&D&&(0,n.jsx)(S.i,{error:D,handleClose:()=>F(null),sendMessage:b?p:void 0,isStreaming:f})]}),void 0===a||void 0===r?null:r===u.vU.Code||o?(0,n.jsx)(d.Z,{noDefaultScroll:!c,ref:O,className:(0,h.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",k&&N),children:(0,n.jsx)(A,{content:a,isStreaming:f,language:s,sendMessage:p,isOpen:t},"code-".concat(y,"-").concat(w,"-").concat(c))}):r===u.vU.Markdown?(0,n.jsx)(d.Z,{noDefaultScroll:!c,ref:O,className:(0,h.A)("ease-out duration-200","relative flex w-full flex-1 overflow-x-auto overflow-y-scroll",k&&N),children:(0,n.jsx)(P,{content:a,citations:l,isStreaming:f,sendMessage:p,isOpen:t},"markdown-".concat(y,"-").concat(w,"-").concat(c))}):null]})},A=e=>{let{content:t,isStreaming:a,language:r,sendMessage:o,isOpen:d}=e,{codeStyle:u}=(0,i.V)(),{exceedsSizeLimit:f}=(0,c.y)(t),h="code-block__code !my-0 h-fit min-h-full w-fit min-w-full !rounded-none !text-sm !leading-relaxed ";return(0,n.jsx)(C,{isStreaming:a,sendMessage:o,contentType:"code",isOpen:d,children:f?(0,n.jsx)(s.R,{code:t,codeClassName:"".concat(h," p-3.5")}):(0,n.jsx)(g.A,{className:h,language:r,PreTag:"div",style:u,renderer:l.G,children:t})})},P=e=>{let{content:t,citations:a,isStreaming:s,sendMessage:l,isOpen:i}=e,c=(0,f.n)(),d=(0,m.useMemo)(()=>c&&a&&a.length>0?(0,o.k0)(a,t):t,[t,a,c]);return(0,n.jsx)(C,{isStreaming:s,sendMessage:l,isOpen:i,children:(0,n.jsxs)("div",{tabIndex:0,id:"markdown-artifact",className:"font-claude-response mx-auto w-full max-w-3xl leading-[1.65rem] px-6 pt-4 md:pt-6 md:px-11",children:[(0,n.jsx)(r.fP,{text:d,blockCitations:a,className:"!gap-3.5",isStreaming:s,normalizationMode:"markdown-document",chatUiCore:!0}),(0,n.jsx)("div",{className:"h-8"})]})})},T=(e,t)=>{if(!e||!t)return -1;let a=e.replace(/\\n/g,"\n"),n=t.replace(/\\n/g,"\n"),s=[...a].findIndex((e,t)=>e!==n[t]);if(-1===s&&a.length===n.length)return -1;let l=(a.slice(0,-1===s?a.length:s).match(/\n/g)||[]).length,r=(a.match(/\n/g)||[]).length;return r?Math.round(l/r*100):-1}}}]);
try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="6a18bb91-84d4-484f-8db3-964ba1bc154f",e._sentryDebugIdIdentifier="sentry-dbid-6a18bb91-84d4-484f-8db3-964ba1bc154f")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[59380],{0x6520adcb:(e,t,n)=>{n.d(t,{Ko:()=>r,SV:()=>i,Uq:()=>s,_s:()=>a,gq:()=>u,qs:()=>d,t6:()=>c});var o=n(0x156c4e43b);let a=o.Ik({channel:o.k5(["request","response"]),requestId:o.Yj()}).passthrough(),s=a.strict().extend({channel:o.eu("request"),method:o.Yj(),payload:o.re({"@type":o.Yj()})}),r=a.extend({channel:o.eu("response"),status:o.ai().int().min(100).max(599),payload:o.re({"@type":o.Yj()}).passthrough()}).passthrough(),c=r.extend({status:o.ai().int().min(400).max(599),payload:o.re({"@type":o.eu("type.googleapis.com/anthropic.claude.usercontent.ErrorResponse"),error:o.Yj()})}),u=r.extend({payload:o.re({"@type":o.eu("type.googleapis.com/google.protobuf.Empty")})}),d={"@type":"type.googleapis.com/google.protobuf.Empty"},i=e=>({"@type":"type.googleapis.com/anthropic.claude.usercontent.ErrorResponse",error:e})},0x112f760bb:(e,t,n)=>{n.d(t,{Z:()=>s});var o=n(0x22102fd88),a=n(0xfc89b4a4);let s=(0,a.forwardRef)((e,t)=>{var n,s;let{className:r,children:c,disabled:u,noDefaultScroll:d,initialScrollState:i,onScrollChange:l}=e,p=(0,a.useRef)(null!=(n=null==i?void 0:i.scrollTop)?n:0),h=(0,a.useRef)(null==(s=null==i?void 0:i.isPinned)||s),m=(0,a.useRef)(!1),g=(0,a.useRef)(null),x=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";if(g.current&&h.current&&!(g.current.scrollHeight-g.current.clientHeight<g.current.scrollTop)&&g.current&&"function"==typeof g.current.scrollTo){var t,n,o;null==(o=g.current)||o.scrollTo({top:(null==(t=g.current)?void 0:t.scrollHeight)-(null==(n=g.current)?void 0:n.clientHeight)+5,behavior:e})}},[]),y=(0,a.useCallback)(e=>{if(g.current&&g.current&&"function"==typeof g.current.scrollTo){var t,n,o;g.current.style.overflow="hidden",null==(o=g.current)||o.scrollTo({top:(null==(t=g.current)?void 0:t.scrollHeight)*e-(null==(n=g.current)?void 0:n.clientHeight)/2,behavior:"auto"})}},[]),b=(0,a.useCallback)(()=>{g.current&&(g.current.style.overflow="")},[]);return(0,a.useImperativeHandle)(t,()=>({reset(){p.current=0,h.current=!0,d||x()},scrollToBottomIfPinned:x,scrollToPercentage:y,enableScrolling:b,getScrollContainer:()=>g.current}),[x,y,b,d]),(0,a.useLayoutEffect)(()=>{if(!u&&c&&!d)if(i&&!m.current){if(!g.current)return;let e=g.current.scrollHeight-g.current.clientHeight;i.isPinned?e>0&&(m.current=!0,x()):e>=i.scrollTop&&(m.current=!0,g.current.scrollTo({top:i.scrollTop,behavior:"auto"}))}else x()},[c,u,x,d,i]),(0,o.jsx)("div",{className:r,onScroll:e=>{if(u)return;let t=e.currentTarget.scrollTop,n=function(e,t){if(!e)return!1;{let n=e.scrollHeight-8;return Math.ceil(t+e.offsetHeight)>=Math.floor(n)}}(g.current,t),o=t>p.current;n&&o?h.current=!0:n||o||(h.current=!1),p.current=t,l&&l({scrollTop:t,isPinned:h.current})},ref:g,children:c})});s.displayName="AutoScroll"},0x1137a9c1a:(e,t,n)=>{n.d(t,{K_:()=>x,Ub:()=>m,tH:()=>S,uZ:()=>r,v9:()=>b,x8:()=>y,zN:()=>h});var o=n(0x24fcf6beb),a=n(0x156c4e43b),s=n(0x6520adcb),r=function(e){return e.ReadyForContent="anthropic.claude.usercontent.sandbox.ReadyForContent",e.SetContent="anthropic.claude.usercontent.sandbox.SetContent",e.GetFile="anthropic.claude.usercontent.sandbox.GetFile",e.SendConversationMessage="anthropic.claude.usercontent.sandbox.SendConversationMessage",e.RunCode="anthropic.claude.usercontent.sandbox.RunCode",e.ClaudeCompletion="anthropic.claude.usercontent.sandbox.ClaudeCompletion",e.ReportError="anthropic.claude.usercontent.sandbox.ReportError",e.GetScreenshot="anthropic.claude.usercontent.sandbox.GetScreenshot",e.BroadcastContentSize="anthropic.claude.usercontent.sandbox.BroadcastContentSize",e.OpenExternal="anthropic.claude.usercontent.sandbox.OpenExternal",e.DownloadFile="anthropic.claude.usercontent.sandbox.DownloadFile",e.CopyHtmlContent="anthropic.claude.usercontent.sandbox.CopyHtmlContent",e.TrackInteraction="anthropic.claude.usercontent.sandbox.TrackInteraction",e.ProxyFetch="anthropic.claude.usercontent.sandbox.ProxyFetch",e.ProxyFetchStream="anthropic.claude.usercontent.sandbox.ProxyFetchStream",e.GetDOMSnapshot="anthropic.claude.usercontent.sandbox.GetDOMSnapshot",e.DOMContentLoaded="anthropic.claude.usercontent.sandbox.DOMContentLoaded",e.StorageGet="anthropic.claude.usercontent.sandbox.StorageGet",e.StorageSet="anthropic.claude.usercontent.sandbox.StorageSet",e.StorageDelete="anthropic.claude.usercontent.sandbox.StorageDelete",e.StorageList="anthropic.claude.usercontent.sandbox.StorageList",e}({});let c=a.Ik({type:a.eu("UnsupportedImports"),unsupportedModules:a.YO(a.Yj()),nonExistentIcons:a.YO(a.Yj())}),u=a.Ik({type:a.eu("RuntimeError"),message:a.Yj()}),d=a.Ik({type:a.eu("FileNotFound"),fileName:a.Yj()}),i=a.Ik({type:a.eu("ClaudeCompletionError"),message:a.Yj()}),l=a.Ik({type:a.eu("ArtifactStorageError"),message:a.Yj()}),p=a.gM("type",[c,u,d,i,l]),h=a.Ik({code:a.Yj()}),m=a.Ik({status:a.k5(["success","error"]),result:a.Yj().optional(),logs:a.YO(a.Yj()),error:a.Yj().optional()}),g={"anthropic.claude.usercontent.sandbox.CopyHtmlContent":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.CopyHtmlContent"),payload:a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentRequest")})}),responseSchema:s.Ko.extend({payload:a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentResponse"),reportHTMLContent:a.Yj()})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SetContent":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.SetContent"),payload:a.gM("type",[a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"),content:a.Yj(),type:a.fc(o.vU),watchContentSize:a.zM().optional(),tailwindStylesEnabled:a.zM().optional()}),a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"),content:a.KC([a.Yj(),a.Nl(ArrayBuffer)]),type:a.fc(o.qK),watchContentSize:a.zM().optional(),tailwindStylesEnabled:a.zM().optional()})])}),responseSchema:s.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReadyForContent":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.ReadyForContent"),payload:a.re({"@type":a.eu("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.BroadcastContentSize":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.BroadcastContentSize"),payload:a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.BroadcastContentSizePayload"),height:a.ai(),width:a.ai()})}),responseSchema:s.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.GetFile":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.GetFile"),payload:a.re({key:a.Yj(),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileRequest")})}),responseSchema:s.Ko.extend({payload:a.re({value:a.Nl(Uint8Array).nullable(),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SendConversationMessage":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.SendConversationMessage"),payload:a.re({message:a.Yj(),messageType:a.k5(["text","error"]),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.SendConversationMessageRequest")})}),responseSchema:s.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.RunCode":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.RunCode"),payload:a.re({code:a.Yj(),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeRequest")})}),responseSchema:s.Ko.extend({payload:a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeResponse")}).merge(m)}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ClaudeCompletion":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.ClaudeCompletion"),payload:a.re({prompt:a.Yj(),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest")})}),responseSchema:s.Ko.extend({payload:a.re({completion:a.Yj().nullable(),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReportError":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.ReportError"),payload:a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.ReportErrorRequest"),error:p})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.GetScreenshot":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.GetScreenshot"),payload:a.re({"@type":a.eu("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:s.Ko.extend({payload:a.re({screenshot:a.Yj().nullable(),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetScreenshotResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.OpenExternal":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.OpenExternal"),payload:a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.OpenExternal"),href:a.Yj()})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.DownloadFile":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.DownloadFile"),payload:a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.DownloadFile"),filename:a.Yj(),data:a.Nl(ArrayBuffer),mimeType:a.Yj()})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.TrackInteraction":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.TrackInteraction"),payload:a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.TrackInteraction"),interactionType:a.eu("click")})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.ProxyFetch":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.ProxyFetch"),payload:a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchRequest"),url:a.Yj(),method:a.Yj(),headers:a.g1(a.Yj()),body:a.Nl(ArrayBuffer).nullable(),channelId:a.Yj()})}),responseSchema:s.Ko.extend({payload:a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchResponse"),status:a.ai(),statusText:a.Yj(),headers:a.g1(a.Yj())})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ProxyFetchStream":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.ProxyFetchStream"),payload:a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest"),channelId:a.Yj(),chunk:a.Nl(ArrayBuffer).nullable(),done:a.zM(),error:a.Yj().optional()})}),responseSchema:s.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.GetDOMSnapshot":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.GetDOMSnapshot"),payload:a.re({"@type":a.eu("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:s.Ko.extend({payload:a.re({"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetDOMSnapshotResponse"),domSnapshot:a.Yj().nullable()})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.DOMContentLoaded":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.DOMContentLoaded"),payload:a.re({"@type":a.eu("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.StorageGet":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.StorageGet"),payload:a.re({key:a.Yj(),shared:a.zM().optional().default(!1),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageGetRequest")})}),responseSchema:s.Ko.extend({payload:a.re({key:a.Yj(),value:a.Yj(),shared:a.zM(),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageGetResponse")}).nullable()}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.StorageSet":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.StorageSet"),payload:a.re({key:a.Yj(),value:a.Yj(),shared:a.zM().optional().default(!1),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageSetRequest")})}),responseSchema:s.Ko.extend({payload:a.re({key:a.Yj(),value:a.Yj(),shared:a.zM(),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageSetResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.StorageDelete":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.StorageDelete"),payload:a.re({key:a.Yj(),shared:a.zM().optional().default(!1),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageDeleteRequest")})}),responseSchema:s.Ko.extend({payload:a.re({key:a.Yj(),deleted:a.zM(),shared:a.zM(),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageDeleteResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.StorageList":{requestSchema:s.Uq.extend({method:a.eu("anthropic.claude.usercontent.sandbox.StorageList"),payload:a.re({prefix:a.Yj().optional(),shared:a.zM().optional().default(!1),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageListRequest")})}),responseSchema:s.Ko.extend({payload:a.re({keys:a.YO(a.Yj()),prefix:a.Yj().nullable().optional(),shared:a.zM(),"@type":a.eu("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageListResponse")})}),alwaysPermitted:!1}},x=a.k5(["anthropic.claude.usercontent.sandbox.ReadyForContent","anthropic.claude.usercontent.sandbox.GetFile","anthropic.claude.usercontent.sandbox.SendConversationMessage","anthropic.claude.usercontent.sandbox.ClaudeCompletion","anthropic.claude.usercontent.sandbox.ReportError","anthropic.claude.usercontent.sandbox.BroadcastContentSize","anthropic.claude.usercontent.sandbox.OpenExternal","anthropic.claude.usercontent.sandbox.DownloadFile","anthropic.claude.usercontent.sandbox.TrackInteraction","anthropic.claude.usercontent.sandbox.ProxyFetch","anthropic.claude.usercontent.sandbox.DOMContentLoaded","anthropic.claude.usercontent.sandbox.StorageGet","anthropic.claude.usercontent.sandbox.StorageSet","anthropic.claude.usercontent.sandbox.StorageDelete","anthropic.claude.usercontent.sandbox.StorageList"]),y=a.gM("method",[g["anthropic.claude.usercontent.sandbox.ReadyForContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetFile"].requestSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].requestSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].requestSchema,g["anthropic.claude.usercontent.sandbox.ReportError"].requestSchema,g["anthropic.claude.usercontent.sandbox.BroadcastContentSize"].requestSchema,g["anthropic.claude.usercontent.sandbox.OpenExternal"].requestSchema,g["anthropic.claude.usercontent.sandbox.DownloadFile"].requestSchema,g["anthropic.claude.usercontent.sandbox.TrackInteraction"].requestSchema,g["anthropic.claude.usercontent.sandbox.ProxyFetch"].requestSchema,g["anthropic.claude.usercontent.sandbox.DOMContentLoaded"].requestSchema,g["anthropic.claude.usercontent.sandbox.StorageGet"].requestSchema,g["anthropic.claude.usercontent.sandbox.StorageSet"].requestSchema,g["anthropic.claude.usercontent.sandbox.StorageDelete"].requestSchema,g["anthropic.claude.usercontent.sandbox.StorageList"].requestSchema]);a.KC([s.gq,g["anthropic.claude.usercontent.sandbox.GetFile"].responseSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].responseSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].responseSchema,g["anthropic.claude.usercontent.sandbox.ProxyFetch"].responseSchema,g["anthropic.claude.usercontent.sandbox.StorageGet"].responseSchema,g["anthropic.claude.usercontent.sandbox.StorageSet"].responseSchema,g["anthropic.claude.usercontent.sandbox.StorageDelete"].responseSchema,g["anthropic.claude.usercontent.sandbox.StorageList"].responseSchema]),a.k5(["anthropic.claude.usercontent.sandbox.SetContent","anthropic.claude.usercontent.sandbox.RunCode","anthropic.claude.usercontent.sandbox.GetScreenshot","anthropic.claude.usercontent.sandbox.CopyHtmlContent","anthropic.claude.usercontent.sandbox.ProxyFetchStream","anthropic.claude.usercontent.sandbox.GetDOMSnapshot"]),a.gM("method",[g["anthropic.claude.usercontent.sandbox.SetContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetScreenshot"].requestSchema,g["anthropic.claude.usercontent.sandbox.CopyHtmlContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.ProxyFetchStream"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetDOMSnapshot"].requestSchema]);let b=a.KC([g["anthropic.claude.usercontent.sandbox.SetContent"].responseSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].responseSchema,g["anthropic.claude.usercontent.sandbox.GetScreenshot"].responseSchema,g["anthropic.claude.usercontent.sandbox.CopyHtmlContent"].responseSchema,g["anthropic.claude.usercontent.sandbox.ProxyFetchStream"].responseSchema,g["anthropic.claude.usercontent.sandbox.GetDOMSnapshot"].responseSchema]),S=Object.entries(g).filter(e=>{let[t,n]=e;return!0===n.alwaysPermitted}).map(e=>{let[t,n]=e;return t})},0x1ad992c78:(e,t,n)=>{n.d(t,{E:()=>c});var o=n(0x9845e38c),a=n(0xfc89b4a4),s=n(0x1137a9c1a),r=n(0x1fb8fadd1);function c(e){let{iframeRef:t,allowedOrigin:n,onRateLimited:c=null,initialPermissions:u,onPermissionRequested:d,onCapabilityAction:i}=e,[l,p]=(0,a.useState)(null),h=(0,a.useRef)(u),[m,g]=(0,a.useState)(0);(0,a.useEffect)(()=>{if(!t.current&&m<20){let e=setTimeout(()=>{g(e=>e+1)},500);return()=>clearTimeout(e)}if(!t.current)return void o.v.warn(o.u.ARTIFACTS,"Max retries reached while waiting for iframe");let e=new r.x({iframe:t.current,allowedOrigin:n,onRateLimited:c,onPermissionRequested:async e=>{if(s.tH.includes(e)||"accepted"===h.current[e])return"accepted";let t=await d(e);return h.current={...h.current,[e]:t},t},onCapabilityAction:i});return p(e),()=>{e.cleanup()}},[t,n,h,c,d,i,m]);let x=(0,a.useCallback)(async(e,t)=>{if(l)return l.sendRequest(e,t);throw Error("Communicator not initialized")},[l]),y=(0,a.useCallback)(()=>{null==l||l.restartListening()},[l]),b=(0,a.useCallback)((e,t)=>{h.current={...h.current,[e]:t}},[]);return{sendRequest:null===l?void 0:x,restartListening:y,permissions:h.current,updatePermission:b}}},0x1fb8fadd1:(e,t,n)=>{n.d(t,{x:()=>c});var o=n(0x9845e38c),a=n(0x1137a9c1a),s=n(0x6520adcb);let r=new Map;class c{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(e.origin!==this.allowedOrigin||e.source!==this.iframe.contentWindow)return;let t=Date.now();if(t-this.lastResetTime>this.RESET_INTERVAL&&(this.messageCount=0,this.lastResetTime=t),this.messageCount++,this.messageCount>this.MAX_MESSAGES_PER_INTERVAL){window.removeEventListener("message",this.boundHandleMessage),this.onRateLimited&&this.onRateLimited();return}let n=s._s.safeParse(e.data);if(!n.success)return void o.v.warn(o.u.ARTIFACTS,"Received message does not conform to basic message shape, ignoring");let a=n.data;if("response"===a.channel)return void this.handleResponse(a);this.messageQueue.push(a),this.isConsumerRunning||this.consumeMessages()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId)||r.get(e.requestId);if(void 0!==t){t(e),r.delete(e.requestId);return}}async consumeMessages(){for(this.isConsumerRunning=!0;this.messageQueue.length>0;){let e=this.messageQueue.shift();if(!e)continue;let t=a.K_.safeParse(e.method);if(!t.success){this.sendErrorResponse(e.requestId,400,"Unknown method");continue}let n=t.data,r=a.x8.safeParse(e);if(!r.success){this.sendErrorResponse(e.requestId,400,"Invalid payload content");continue}let c=r.data;if(this.requestLog.has(c.requestId)){this.sendErrorResponse(c.requestId,400,"Request ID already processed");continue}this.requestLog.set(c.requestId,{message:c,requestTimestamp:new Date().getTime()}),await this.onPermissionRequested(n).then(e=>"denied"!==e||(this.sendErrorResponse(c.requestId,403,"Permission denied"),!1)).catch(e=>(o.v.error(o.u.ARTIFACTS,"Error checking permission for method ".concat(n,":"),e),this.sendErrorResponse(c.requestId,500,"Error checking permission"),!1))&&(this.onCapabilityAction(c,this.boundSendRequest).then(e=>{var t;let n=s.Ko.parse({channel:"response",status:200,requestId:c.requestId,payload:null!=e?e:s.qs}),o=this.requestLog.get(c.requestId);o&&this.requestLog.set(c.requestId,{...o,response:n,responseTimestamp:new Date().getTime()}),null==(t=this.iframe.contentWindow)||t.postMessage(n,this.allowedOrigin)}).catch(e=>{o.v.error(o.u.ARTIFACTS,"Error processing action for method ".concat(n,":"),e),this.sendErrorResponse(c.requestId,500,"Internal server error while processing action")}),await new Promise(e=>requestAnimationFrame(e)))}this.isConsumerRunning=!1}sendErrorResponse(e,t,n){var o;let a=s.t6.parse({channel:"response",status:t,requestId:e,payload:(0,s.SV)(n)}),r=this.requestLog.get(e);r&&this.requestLog.set(e,{...r,response:a,responseTimestamp:new Date().getTime()}),null==(o=this.iframe.contentWindow)||o.postMessage(a,this.allowedOrigin)}restartListening(){window.removeEventListener("message",this.boundHandleMessage),this.messageCount=0,this.lastResetTime=Date.now(),this.setupMessageListener()}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.messageQueue=[],this.isConsumerRunning=!1,this.inFlightRequests.clear()}async sendRequest(e,t,n){return new Promise((o,c)=>{var u,d;let i=Date.now().toString(),l={channel:"request",method:e,requestId:i,payload:t},p=e=>{let t=s.Ko.safeParse(e);if(!t.success)return void c(Error("Invalid response format"));let n=t.data;if(n.status>=400){let e=s.t6.safeParse(n);e.success?c(Error(e.data.payload.error)):c(Error("Error response (".concat(n.status,")")));return}let r=a.v9.safeParse(n);r.success?o(r.data.payload):c(Error("Invalid response payload for the method"))};this.inFlightRequests.set(i,p),r.set(i,p),n&&n.length>0?null==(u=this.iframe.contentWindow)||u.postMessage(l,this.allowedOrigin,n):null==(d=this.iframe.contentWindow)||d.postMessage(l,this.allowedOrigin)})}getRequestLog(){return Array.from(this.requestLog.entries()).map(e=>{let[t,n]=e;return{...n,requestId:t}}).sort((e,t)=>t.requestTimestamp-e.requestTimestamp)}constructor({iframe:e,allowedOrigin:t,onRateLimited:n=null,onPermissionRequested:o,onCapabilityAction:a}){this.messageCount=0,this.lastResetTime=Date.now(),this.MAX_MESSAGES_PER_INTERVAL=30,this.RESET_INTERVAL=5e3,this.onRateLimited=null,this.messageQueue=[],this.isConsumerRunning=!1,this.requestLog=new Map,this.inFlightRequests=new Map,this.iframe=e,this.allowedOrigin=t,this.onRateLimited=n,this.onPermissionRequested=o,this.onCapabilityAction=a,this.boundHandleMessage=this.handleMessage.bind(this),this.boundSendRequest=this.sendRequest.bind(this),this.setupMessageListener()}}}}]);